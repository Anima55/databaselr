# Лабораторна робота 2. Створення складних SQL запитів

## Загальна інформація

**Здобувач освіти:** [Ваше ПІБ]
**Група:** [Номер групи]
**Обраний рівень складності:** [1/2/3]

## Виконання завдань

### Рівень 1

#### 1. З'єднання таблиць

**Завдання 1.1:** INNER JOIN - список товарів з категоріями та постачальниками

```sql
SELECT p.product_name, c.category_name, s.company_name, p.unit_price
FROM products p
INNER JOIN categories c ON p.category_id = c.category_id
INNER JOIN suppliers s ON p.supplier_id = s.supplier_id
ORDER BY c.category_name, p.product_name;

```

**Результат виконання:**
```
-- lr2/skrin/Screenshot_1.png

```

**Пояснення:** Опишіть, що робить цей запит та які таблиці з'єднуються.



**Завдання 1.2:** LEFT JOIN - клієнти з кількістю замовлень

```sql
SELECT c.contact_name, c.customer_type, r.region_name,
      COUNT(o.order_id) as order_count
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
LEFT JOIN regions r ON c.region_id = r.region_id
GROUP BY c.customer_id, c.contact_name, c.customer_type, r.region_name
ORDER BY order_count DESC;

```

**Результат виконання:**
```
-- lr2/skrin/Screenshot_2.png

```

**Пояснення:** Поясніть різницю між INNER JOIN та LEFT JOIN на цьому прикладі.



**Завдання 1.3:** Множинне з'єднання - детальна інформація про замовлення

```sql
SELECT
    r.region_name AS "Регіон Доставки",
    p.product_name AS "Назва Товару",
    SUM(oi.quantity) AS "Загальна Кількість (шт.)",
    ROUND(SUM(oi.unit_price * oi.quantity * (1 - oi.discount)), 2) AS "Загальний Дохід"
FROM regions r
JOIN orders o ON r.region_id = o.ship_region_id  -- 1. З'єднання Регіонів з Замовленнями
JOIN order_items oi ON o.order_id = oi.order_id  -- 2. З'єднання Замовлень з Деталями Замовлень
JOIN products p ON oi.product_id = p.product_id  -- 3. З'єднання Деталей Замовлень з Товарами
WHERE o.order_status = 'delivered' -- Враховуємо лише виконані замовлення
GROUP BY r.region_name, p.product_name
ORDER BY "Регіон Доставки" ASC, "Загальний Дохід" DESC;

```

**Результат виконання:**
```
-- lr2/skrin/Screenshot_3.png

```

**Аналіз складності:** Оцініть складність запиту та поясніть послідовність з'єднань.



#### 2. Агрегатні функції

**Завдання 2.1:** Статистика товарів за категоріями

```sql
-- COUNT, AVG, MIN, MAX по категоріях

```

**Результат виконання:**
```
-- Результат

```

**Завдання 2.2:** Продажі за регіонами з використанням HAVING

```sql
-- SUM, GROUP BY, HAVING

```

**Результат виконання:**
```
-- Результат

```

**Завдання 2.3:** Постачальники з кількістю товарів більше 2

```sql
-- Запит з HAVING

```

**Результат виконання:**
```
-- Результат

```



#### 3. Базові підзапити

**Завдання 3.1:** Товари з ціною вище середньої по категорії

```sql
-- Корельований підзапит

```

**Результат виконання:**
```
-- Результат

```

**Завдання 3.2:** Клієнти з замовленнями у 2024 році

```sql
-- Підзапит з IN

```

**Результат виконання:**
```
-- Результат

```

**Завдання 3.3:** Товари з загальною кількістю продажів

```sql
-- Підзапит у SELECT

```

**Результат виконання:**
```
-- Результат

```



### Рівень 2

#### 4. Складні з'єднання

**Завдання 4.1:** RIGHT JOIN - аналіз категорій та товарів

```sql
-- RIGHT JOIN код

```

**Результат виконання:**
```
-- Результат

```

**Завдання 4.2:** Self-join - співробітники та керівники

```sql
-- Self-join код

```

**Результат виконання:**
```
-- Результат

```



#### 5. Віконні функції

**Завдання 5.1:** Ранжування товарів за ціною в категоріях

```sql
-- RANK(), DENSE_RANK(), ROW_NUMBER() код

```

**Результат виконання:**
```
-- Результат

```

**Завдання 5.2:** Порівняння замовлень з попередніми датами

```sql
-- LAG(), LEAD() код

```

**Результат виконання:**
```
-- Результат

```



### Рівень 3

#### 6. Матеріалізовані представлення та рекурсивні запити

**Завдання 6.1:** Матеріалізоване представлення для аналізу продажів

```sql
-- CREATE MATERIALIZED VIEW код

```

**Пояснення:** Поясніть переваги використання матеріалізованих представлень.

**Завдання 6.2:** Рекурсивний запит для ієрархії співробітників

```sql
-- WITH RECURSIVE код

```

**Результат виконання:**
```
-- Результат

```



## Аналіз продуктивності

### Дослідження планів виконання

**Найповільніший запит:**
```sql
-- Код запиту

```

**План виконання (EXPLAIN ANALYZE):**
```
-- Результат EXPLAIN ANALYZE

```

**Запропоновані оптимізації:**
1. [Опис оптимізації 1]
2. [Опис оптимізації 2]
3. [Опис оптимізації 3]

### Створені індекси

**Індекс 1:**
```sql
-- CREATE INDEX код

```
**Обґрунтування:** [Пояснення чому цей індекс потрібен]

**Індекс 2:**
```sql
-- CREATE INDEX код

```
**Обґрунтування:** [Пояснення]



## Порівняльний аналіз

### Ефективність різних підходів

**Завдання:** Знайти топ-5 найдорожчих товарів у кожній категорії

**Підхід 1: Віконні функції**
```sql
-- Код з віконними функціями

```

**Підхід 2: Корельований підзапит**
```sql
-- Код з підзапитом

```

**Час виконання:**
- Віконні функції: [час]
- Корельований підзапит: [час]

**Висновок:** [Порівняння ефективності]



## Висновки

**Самооцінка**: [ваша оцінка роботи, 3-5]

**Обгрунтування**: [обґрунтування самооцінки]
